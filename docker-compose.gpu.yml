# docker-compose.gpu.yml
# Optional overlay for GPU acceleration (NVIDIA)
#
# This overlay enables GPU runtime for celery-worker on systems with NVIDIA GPUs.
# It automatically detects NVIDIA Container Toolkit availability.
#
# Usage:
#   ./opentr.sh start dev              # Auto-detects GPU and applies if available
#   OR manually:
#   docker compose -f docker-compose.yml -f docker-compose.gpu.yml up
#
# Note: This file is automatically included by opentr.sh when NVIDIA GPU is detected.
# On macOS or systems without NVIDIA GPU, this file is not loaded.

services:
  celery-worker:
    # Enable NVIDIA runtime for GPU acceleration
    # Note: deploy.resources is preferred over runtime: nvidia in newer Docker versions
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [gpu]
              device_ids: ['${GPU_DEVICE_ID:-0}']

